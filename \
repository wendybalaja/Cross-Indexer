myprogram = ARGV[0]

llvmOut, llvmIO = IO.pipe
fork do
  res = system("llvm-dwarfdump --debug-line #{myprogram}", out: llvmIO, err: :out)
end 

llvmIO.close

debug_matcher = /^0x0000000000([0-9a-z]{6})\s+([0-9]*)\s+([0-9]*)\s+([0-9]*)\s+([0-9]*)\s+([0-9]*)\s+([a-z]+.*)$.*/
file_name_matcher = /^(file_names)+(\[)\s+([0-9].*)+(\]:)\n +(name:)\s+("[a-z].*)$/\


llvmOut.each{ |l|
  if debug_matcher(l) then
    puts Regexp.last_match(1)
    puts Regexp.last_match(2)
}
